<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Chi tiết</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
:root{
  --primary:#0d6efd;--neon:#00f7ff;--dark:#0f0f0f;--gray:#1f1f1f;--light-gray:#2a2a2a;--radius:18px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--dark);color:#fff;font-family:'Segoe UI',sans-serif;overflow-x:hidden;line-height:1.6;}
.container{max-width:1366px;margin:auto;padding:0 20px;}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;background:rgba(15,15,15,.96);padding:14px 0;z-index:1000;backdrop-filter:blur(16px);box-shadow:0 6px 25px rgba(0,0,0,.5);border-bottom:1px solid rgba(0,247,255,.15);}
.nav{display:flex;justify-content:space-between;align-items:center;}
.back-btn,.home-btn{background:none;border:none;color:#fff;font-size:1.6rem;cursor:pointer;transition:.35s;padding:8px;border-radius:50%;}
.back-btn:hover,.home-btn:hover{background:rgba(13,110,253,.3);color:var(--neon);}
.logo{font-size:28px;font-weight:900;color:transparent;background:linear-gradient(90deg,var(--primary),var(--neon));-webkit-background-clip:text;background-clip:text;text-shadow:0 0 15px rgba(0,247,255,.4);}

/* HERO */
.detail-hero{height:76vh;background:linear-gradient(135deg,rgba(15,15,15,.92),rgba(0,0,0,.98)),url('');background-size:cover;background-position:center;display:flex;align-items:center;margin-top:68px;border-radius:0 0 var(--radius) var(--radius);position:relative;overflow:hidden;box-shadow:0 25px 60px rgba(0,0,0,.7);}
.detail-hero::before{content:'';position:absolute;inset:0;background:linear-gradient(to right,rgba(12,12,12,.98) 0%,rgba(15,15,15,.7) 50%,transparent 100%);z-index:1;}
.detail-content{max-width:680px;padding-left:45px;position:relative;z-index:2;}
.detail-title{font-size:3.6rem;font-weight:900;margin-bottom:14px;text-shadow:0 3px 12px rgba(0,0,0,.9);background:linear-gradient(90deg,#fff,var(--neon));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.1;}
.meta{display:flex;gap:14px;flex-wrap:wrap;color:#ccc;margin:14px 0;font-size:1.05rem;font-weight:500;}
.meta span{position:relative;}
.meta span:not(:last-child)::after{content:'•';margin-left:14px;color:var(--neon);opacity:.7;}
.rating{background:linear-gradient(135deg,#ffc107,#ff9800);color:#000;padding:8px 18px;border-radius:22px;font-weight:800;font-size:1rem;display:inline-flex;align-items:center;gap:7px;box-shadow:0 0 20px rgba(255,193,7,.5);}
.rating i{color:#000;font-size:1.1rem;}
.source-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(0,0,0,.7);padding:6px 12px;border-radius:20px;font-size:0.9rem;font-weight:600;margin-bottom:16px;margin-right:8px;}
.source-badge.ax{background:rgba(255,87,51,.8);}
.source-badge.bx{background:rgba(33,150,243,.8);}
.source-badge.cx{background:rgba(76,175,80,.8);}
.source-badge.tmdb{background:rgba(1,180,228,.8);}

/* INFO GRID */
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:24px;margin:45px 0;background:rgba(255,255,255,.04);padding:26px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.4);border:1px solid rgba(0,247,255,.12);}
.info-item{background:rgba(255,255,255,.03);padding:16px;border-radius:14px;transition:.3s;}
.info-item:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,247,255,.2);}
.info-label{font-size:.9rem;color:#aaa;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
.info-value{font-size:1.15rem;font-weight:700;color:var(--neon);text-shadow:0 0 10px rgba(0,247,255,.5);}

/* PLAY BUTTON */
.play-btn{padding:16px 38px;display:inline-flex;gap:12px;align-items:center;background:linear-gradient(135deg,var(--primary),#0b5ed7);color:#fff;border:none;border-radius:14px;cursor:pointer;font-weight:800;font-size:1.2rem;transition:.4s;box-shadow:0 0 25px rgba(13,110,253,.6);margin-top:24px;}
.play-btn:hover{background:linear-gradient(135deg,#0b5ed7,var(--primary));transform:translateY(-4px);box-shadow:0 0 40px rgba(13,110,253,.9);}
.play-btn i{font-size:1.4rem;}

/* CAST */
.cast-section{margin:50px 0;}
.cast-title{font-size:1.9rem;font-weight:700;margin-bottom:20px;background:linear-gradient(90deg,#fff,var(--neon));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.cast-gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(115px,1fr));gap:18px;}
.cast-item{text-align:center;font-size:.92rem;position:relative;overflow:hidden;}
.cast-img{width:100%;height:115px;border-radius:50%;object-fit:cover;border:3px solid var(--light-gray);transition:.4s;box-shadow:0 6px 18px rgba(0,0,0,.4);}
.cast-item:hover .cast-img{border-color:var(--neon);transform:scale(1.08);box-shadow:0 0 30px rgba(0,247,255,.6);}
.cast-name{margin-top:8px;font-weight:600;}

/* RESPONSIVE */
@media(max-width:480px){
  .detail-content{padding-left:18px;}.detail-title{font-size:2.4rem;}.meta{font-size:.95rem;}
  .info-grid{grid-template-columns:1fr;gap:18px;}.cast-gallery{grid-template-columns:repeat(3,1fr);}
}
</style>
</head>

<body>

<header>
  <div class="container nav">
    <button class="back-btn" onclick="history.back()"><i class="fas fa-arrow-left"></i></button>
    <div class="logo" onclick="location.href='index71.html'">Chi Tiết</div>
    <button class="home-btn" onclick="location.href='index71.html'"><i class="fas fa-home"></i></button>
  </div>
</header>

<section class="detail-hero" id="detailHero">
  <div class="detail-content">
    <div id="sourceBadges"></div>
    <h1 class="detail-title" id="detailTitle">Đang tải...</h1>
    <div class="meta">
      <span id="detailYear">-</span>
      <span id="detailRuntime">-</span>
      <span id="detailGenres">-</span>
    </div>
    <div class="rating" id="detailRating"><i class="fas fa-star"></i> 0.0</div>
    <button class="play-btn" id="playBtn"><i class="fas fa-play"></i> Xem ngay</button>
  </div>
</section>

<div class="container">

  <div class="info-grid">
    <div class="info-item"><div class="info-label">Đạo diễn</div><div class="info-value" id="director">-</div></div>
    <div class="info-item"><div class="info-label">Diễn viên</div><div class="info-value" id="cast">-</div></div>
    <div class="info-item"><div class="info-label">Quốc gia</div><div class="info-value" id="country">-</div></div>
    <div class="info-item"><div class="info-label">Ngôn ngữ</div><div class="info-value" id="language">-</div></div>
    <div class="info-item"><div class="info-label">Trạng thái</div><div class="info-value" id="status">-</div></div>
    <div class="info-item"><div class="info-label">Tập phim</div><div class="info-value" id="episodes">-</div></div>
  </div>

  <div class="cast-section" id="castSection" style="display:none;">
    <h2 class="cast-title">Diễn viên</h2>
    <div class="cast-gallery" id="castGallery"></div>
  </div>
</div>

<script>
const urlParams = new URLSearchParams(location.search);
const id = urlParams.get("id");
const type = urlParams.get("type") || "movie";
const slug = urlParams.get("slug");
const source = urlParams.get("source");

const API_KEY = "c1ba4826351c415243b3d8ea82a77cd7";
const BASE = "https://api.themoviedb.org/3";
const IMG = "https://image.tmdb.org/t/p/w500";
const BACK = "https://image.tmdb.org/t/p/original";

const API_SOURCES = {
  ax: {name:'Ophim', url: s => `https://ophim1.com/v1/api/phim/${s}`, cdn: 'https://img.ophim.live/uploads/movies/'},
  bx: {name:'Phimapi', url: s => `https://phimapi.com/phim/${s}`, cdn: 'https://phimimg.com/'},
  cx: {name:'Nguonc', url: s => `https://phim.nguonc.com/api/film/${s}`, cdn: 'https://phim.nguonc.com/public/images/Poster/'}
};

async function fetchData(url){
  try{return await (await fetch(url)).json();}
  catch{return {};}
}

async function loadTMDB(){
  if(!id) return;
  const data = await fetchData(`${BASE}/${type}/${id}?api_key=${API_KEY}&language=vi-VN&append_to_response=credits`);
  
  document.getElementById("sourceBadges").innerHTML = '<div class="source-badge tmdb">TMDB</div>';
  document.getElementById("detailHero").style.backgroundImage = 
    `linear-gradient(135deg,rgba(15,15,15,.92),rgba(0,0,0,.98)),url(${BACK + (data.backdrop_path || data.poster_path)})`;
  
  document.getElementById("detailTitle").textContent = data.title || data.name;
  document.getElementById("detailYear").textContent = new Date(data.release_date||data.first_air_date).getFullYear();
  document.getElementById("detailRuntime").textContent = (data.runtime || data.episode_run_time?.[0] || 45) + " phút";
  document.getElementById("detailGenres").textContent = data.genres?.map(g=>g.name).join(", ") || "-";
  document.getElementById("detailRating").innerHTML = `<i class="fas fa-star"></i> ${data.vote_average?.toFixed(1) || 0}`;

  const credits = data.credits || {};
  document.getElementById("director").textContent = credits.crew?.find(c=>c.job==="Director")?.name || "-";
  document.getElementById("cast").textContent = credits.cast?.slice(0,3).map(c=>c.name).join(", ") || "-";
  document.getElementById("country").textContent = data.production_countries?.[0]?.name || "-";
  document.getElementById("language").textContent = data.spoken_languages?.[0]?.name || "-";
  document.getElementById("status").textContent = data.status || "-";
  document.getElementById("episodes").textContent = type === 'tv' ? `${data.number_of_seasons} mùa, ${data.number_of_episodes} tập` : "Phim lẻ";

  // CAST
  const castSection = document.getElementById("castSection");
  const castGallery = document.getElementById("castGallery");
  if(credits.cast && credits.cast.length > 0) {
    castSection.style.display = 'block';
    castGallery.innerHTML = "";
    credits.cast.slice(0,12).forEach(a=>{
      const div = document.createElement('div');
      div.className = 'cast-item';
      div.innerHTML = `
        <img class="cast-img" src="${a.profile_path? IMG+a.profile_path : 'https://via.placeholder.com/115'}">
        <div class="cast-name">${a.name}</div>`;
      castGallery.appendChild(div);
    });
  }

  // PLAY BUTTON
  document.getElementById("playBtn").onclick = () => {
    window.location.href = `oplay.html?tmdb=${id}&type=${type}&s=1&e=1`;
  };
}

async function loadAPISource(){
  if(!slug || !source) return;
  const src = API_SOURCES[source];
  if(!src) return;
  
  const data = await fetchData(src.url(slug));
  let movie = {};
  
  if(source === 'cx') movie = data.movie;
  else if(source === 'bx') movie = data.movie;
  else movie = data.data?.item;
  
  if(!movie) return;
  
  document.getElementById("sourceBadges").innerHTML = `<div class="source-badge ${source}">${source.toUpperCase()}</div>`;
  
  let thumb = movie.thumb_url || movie.poster_url || movie.poster || '';
  if(thumb && !thumb.startsWith('http')) thumb = src.cdn + thumb.replace(/^\/+/, '');
  
  document.getElementById("detailHero").style.backgroundImage = 
    `linear-gradient(135deg,rgba(15,15,15,.92),rgba(0,0,0,.98)),url(${thumb})`;
  
  document.getElementById("detailTitle").textContent = movie.name || movie.title || "Không rõ";
  document.getElementById("detailYear").textContent = movie.year || "-";
  document.getElementById("detailRuntime").textContent = movie.time || "-";
  document.getElementById("detailGenres").textContent = movie.category?.map(c=>c.name).join(", ") || movie.genre?.join(", ") || "-";
  document.getElementById("detailRating").innerHTML = `<i class="fas fa-star"></i> ${movie.tmdb?.vote_average?.toFixed(1) || movie.rating || 0}`;

  document.getElementById("director").textContent = movie.director?.join(", ") || "-";
  document.getElementById("cast").textContent = movie.actor?.slice(0,3).join(", ") || movie.casts?.slice(0,3) || "-";
  document.getElementById("country").textContent = movie.country?.map(c=>c.name).join(", ") || movie.countries?.join(", ") || "-";
  document.getElementById("language").textContent = movie.lang || "-";
  document.getElementById("status").textContent = movie.status || "-";
  document.getElementById("episodes").textContent = movie.episode_current || movie.current_episode || "-";

  // PLAY BUTTON
  document.getElementById("playBtn").onclick = () => {
    window.location.href = `oplay.html?slug=${slug}&source=${source}&s=1&e=1`;
  };
}

window.onload = () => {
  if(id && type) loadTMDB();
  else if(slug && source) loadAPISource();
  else document.getElementById("detailTitle").textContent = "Thiếu thông tin";
};
</script>
</body>

</html>
