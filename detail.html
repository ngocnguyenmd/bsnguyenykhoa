<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">Movies</title>

  <!-- SEO -->
  <meta property="og:title" content="" id="og-title" />
  <meta property="og:description" content="" id="og-desc" />
  <meta property="og:image" content="" id="og-image" />
  <meta property="og:url" content="" id="og-url" />
  <meta property="og:type" content="video.movie" />
<style>
/* ======== RESET ======== */
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Roboto,sans-serif;overflow-x:hidden;line-height:1.5;}
a{text-decoration:none;color:inherit;}
img{user-select:none;-webkit-user-drag:none;pointer-events:none;}

/* ======== BACKGROUND ======== */
.bg-poster{position:fixed;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;filter:blur(12px) brightness(0.3);z-index:-2;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:-1;}

/* ======== CONTAINER ======== */
.container{max-width:1300px;margin:0 auto;padding:0 1.5rem;position:relative;z-index:10;}

/* ======== HEADER ======== */
header{background:rgba(17,17,17,.95);backdrop-filter:blur(20px);padding:15px 0;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(255,255,255,.08);}
.nav{display:flex;justify-content:space-between;align-items:center;max-width:1300px;margin:0 auto;padding:0 1.5rem;}
.logo{font-size:1.2rem;font-weight:700;color:#fff;letter-spacing:-.5px;cursor:pointer;}
.back-home{background:#0a84ff;color:#fff;padding:8px 16px;border-radius:18px;font-size:.9rem;font-weight:500;transition:all .25s;cursor:pointer;}
.back-home:hover{background:#006edc;transform:scale(1.04);}

/* ======== INFO CARD ======== */
.info-card{background:#111;padding:2rem;border-radius:14px;border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 30px rgba(0,0,0,.5);margin-top:2rem;}

/* ======== LAYOUT: POSTER + INFO (B√äN PH·∫¢I) ======== */
.detail-wrapper{display:flex;gap:2rem;align-items:flex-start;}
.poster-wrapper{flex:0 0 260px;position:relative;perspective:1000px;}
.info-wrapper{flex:1;min-width:0;display:flex;flex-direction:column;gap:1rem;}

/* ======== POSTER TILT EFFECT - GI·ªêNG ROPHIM ======== */
.tilt-card{width:260px;height:390px;position:relative;transform-style:preserve-3d;transition:transform .15s ease-out;box-shadow:0 8px 20px rgba(0,0,0,.6);border-radius:12px;overflow:hidden;cursor:pointer;}
.tilt-card:hover{box-shadow:0 20px 40px rgba(0,0,0,.8);}
.poster-front{width:100%;height:100%;object-fit:cover;border-radius:12px;transition:filter .3s;}
.tilt-card:hover .poster-front{filter:brightness(1.15);}
.tilt-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,rgba(255,255,255,.1),transparent 40%,rgba(0,0,0,.4));opacity:0;transition:opacity .3s;pointer-events:none;}
.tilt-card:hover .tilt-overlay{opacity:1;}
.tilt-glare{position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 50% 50%,rgba(255,255,255,.25),transparent 40%);opacity:0;transition:opacity .3s;pointer-events:none;}
.tilt-card:hover .tilt-glare{opacity:1;}

/* ======== TEXT ======== */
.title{font-size:1.8rem;font-weight:700;color:#0a84ff;margin-bottom:.5rem;}
.original-title{font-size:1rem;color:#aaa;margin-bottom:.5rem;font-style:italic;}

/* ======== INFO TABLE ======== */
.info-table{width:100%;border-collapse:collapse;margin:0;background:#1a1a1a;border-radius:12px;overflow:hidden;}
.info-table td{padding:.9rem 1rem;border-bottom:1px solid rgba(255,255,255,.08);font-size:.95rem;}
.info-table tr:last-child td{border-bottom:none;}
.info-table .label{font-weight:600;color:#0a84ff;width:30%;min-width:120px;}
.info-table .value{color:#ddd;}
.info-table .value a{color:#0a84ff;text-decoration:underline;}

/* ======== DESCRIPTION ======== */
.desc{line-height:1.8;max-height:120px;overflow:hidden;transition:max-height .4s ease;color:#ddd;font-size:.95rem;}
.desc.expanded{max-height:1000px;}
.toggle-desc{color:#0a84ff;cursor:pointer;font-weight:600;margin-top:.6rem;display:inline-block;font-size:.9rem;}
.toggle-desc:hover{text-decoration:underline;}

/* ======== ACTIONS ======== */
.actions{display:flex;gap:12px;margin-top:.5rem;flex-wrap:wrap;}
.btn{padding:12px 24px;border-radius:18px;font-weight:600;display:inline-flex;align-items:center;gap:8px;font-size:.95rem;transition:all .25s;}
.btn-primary{background:#0a84ff;color:#fff;}
.btn-primary:hover{background:#006edc;transform:scale(1.04);}
.btn-secondary{background:#222;color:#fff;border:1px solid rgba(255,255,255,.15);}
.btn-secondary:hover{background:#333;transform:scale(1.04);}

/* ======== EPISODES ======== */
.episodes-section{margin-top:1.5rem;}
.section-title{font-size:1.4rem;font-weight:700;margin-bottom:1rem;text-transform:uppercase;color:#fff;border-left:4px solid #0a84ff;padding-left:.8rem;}
.server-tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:1rem;}
.server-tab{padding:8px 16px;background:#222;border-radius:18px;cursor:pointer;font-size:.9rem;transition:all .25s;}
.server-tab.active,.server-tab:hover{background:#0a84ff;color:#fff;}
.episode-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:10px;}
.episode-btn{padding:10px;text-align:center;background:#222;border-radius:18px;cursor:pointer;font-size:.9rem;transition:all .25s;}
.episode-btn:hover,.episode-btn.active{background:#0a84ff;color:#fff;transform:scale(1.04);}

/* ======== TRAILER ======== */
.trailer-section{margin-top:1.5rem;}
.trailer-iframe{width:100%;height:400px;border-radius:14px;border:none;box-shadow:0 8px 20px rgba(0,0,0,.5);}

/* ======== SKELETON ======== */
.skeleton{background:#222;border-radius:8px;animation:pulse 1.5s ease-in-out infinite;}
@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

/* ======== RESPONSIVE ======== */
@media (max-width:992px){
  .poster-wrapper{flex:0 0 220px;}
  .tilt-card{width:220px;height:330px;}
  .info-card{padding:1.5rem;}
}
@media (max-width:768px){
  .detail-wrapper{flex-direction:column;align-items:center;gap:1.5rem;}
  .poster-wrapper{flex:0 0 100%;max-width:300px;}
  .tilt-card{width:300px;height:450px;}
  .title{font-size:1.5rem;text-align:center;}
  .actions{justify-content:center;}
  .episode-grid{grid-template-columns:repeat(4,1fr);}
  .container{padding:0 1rem;}
  .info-table .label{width:40%;}
}
@media (max-width:480px){
  .episode-grid{grid-template-columns:repeat(3,1fr);}
  .desc{font-size:.9rem;}
  .nav{padding:0 1rem;}
  .back-home{font-size:.85rem;padding:6px 12px;}
  .info-table td{padding:.7rem .8rem;font-size:.9rem;}
  .tilt-card{width:260px;height:390px;}
}
</style>
</head>
<body>

  <div class="bg-poster" id="bg-poster"></div>
  <div class="overlay"></div>

  <header>
    <div class="nav">
      <div class="logo" onclick="location.href='index.html'">Phim Nh√† B√°nh M√¨</div>
      <a class='back-home' href='/'>Quay L·∫°i</a>
    </div>
  </header>

  <div class="container">
    <div id="skeleton" style="display:block;">
      <div class="info-card">
        <div class="detail-wrapper">
          <div class="poster-wrapper"><div class="skeleton" style="width:260px;height:390px;"></div></div>
          <div class="info-wrapper">
            <div class="skeleton" style="height:32px;width:70%;margin:10px 0;"></div>
            <div class="skeleton" style="height:20px;width:50%;"></div>
            <div class="skeleton" style="height:20px;width:60%;margin:8px 0;"></div>
            <div class="skeleton" style="height:20px;width:50%;"></div>
            <div class="skeleton" style="height:100px;margin:20px 0;"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="detail-content" style="display:none;">
      <div class="info-card">
        <div class="detail-wrapper">
          <div class="poster-wrapper">
            <div class="tilt-card" id="tiltCard">
              <img id="poster" class="poster-front" src="" alt="" draggable="false">
              <div class="tilt-overlay"></div>
              <div class="tilt-glare"></div>
            </div>
          </div>
          <div class="info-wrapper">
            <h1 id="title" class="title"></h1>
            <p id="original-title" class="original-title"></p>

            <!-- TABLE INFO -->
            <table class="info-table" id="info-table">
              <tr><td class="label">NƒÉm</td><td class="value" id="year">-</td></tr>
              <tr><td class="label">Ch·∫•t l∆∞·ª£ng</td><td class="value" id="quality">-</td></tr>
              <tr><td class="label">Ng√¥n ng·ªØ</td><td class="value" id="lang">-</td></tr>
              <tr><td class="label">T·∫≠p hi·ªán t·∫°i</td><td class="value" id="episode">-</td></tr>
              <tr><td class="label">ƒê√°nh gi√°</td><td class="value" id="rating">-</td></tr>
              <tr><td class="label">Th·ªÉ lo·∫°i</td><td class="value" id="genres">-</td></tr>
              <tr><td class="label">Qu·ªëc gia</td><td class="value" id="countries">-</td></tr>
              <tr><td class="label">Di·ªÖn vi√™n</td><td class="value" id="actors">-</td></tr>
            </table>

            <p id="desc" class="desc"></p>
            <span id="toggle-desc" class="toggle-desc">Xem th√™m</span>

            <div class="actions">
              <a id="watch-btn" class="btn btn-primary">Xem Ngay</a>
              <a id="trailer-btn" class="btn btn-secondary">Xem Trailer</a>
            </div>

            <div class="trailer-section" id="trailer-section" style="display:none;"></div>

            <div class="episodes-section" id="episodes-section" style="display:none;">
              <div class="section-title">Ch·ªçn t·∫≠p phim</div>
              <div id="server-tabs" class="server-tabs"></div>
              <div id="episode-grid" class="episode-grid"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
// ==================== C·∫§U H√åNH ====================
const TMDB_API_KEY = 'c1ba4826351c415243b3d8ea82a77cd7';
const urlParams = new URLSearchParams(window.location.search);
const slug = urlParams.get("slug");
const sourceCode = urlParams.get("source") || "ax";
const tmdbParam = urlParams.get("tmdb");

// ==================== X√ÅC ƒê·ªäNH NGU·ªíN ====================
let source = "Ophim";
let tmdbId = null;
let mediaType = 'movie';

if (tmdbParam) {
  source = "TMDB";
  const parts = tmdbParam.split('-');
  const lastPart = parts[parts.length - 1];
  if (lastPart === 'tv' || lastPart === 'movie') {
    mediaType = lastPart;
    tmdbId = parts.slice(0, -1).join('-');
  } else {
    tmdbId = tmdbParam;
  }
} else {
  source = {"ax":"Ophim","bx":"Phimapi","cx":"Nguonc"}[sourceCode] || "Ophim";
}

// ==================== KI·ªÇM TRA THAM S·ªê ====================
if (!slug && !tmdbId) {
  showError("Thi·∫øu th√¥ng tin phim! Kh√¥ng c√≥ slug ho·∫∑c TMDB ID.");
  throw new Error("Thi·∫øu th√¥ng tin phim");
}

// ==================== API CONFIG ====================
const API_CONFIG = {
  Ophim: {
    url: `https://ophim1.com/v1/api/phim/${slug}`,
    parser: (data) => {
      const movie = data.data?.item || data.data || data;
      return {
        name: movie.name || movie.title,
        original_name: movie.origin_name,
        year: movie.year,
        quality: movie.quality,
        lang: movie.lang,
        episode_current: movie.episode_current,
        rating: movie.tmdb?.vote_average || movie.rating,
        category: movie.category,
        country: movie.country,
        actor: movie.actor,
        content: movie.content,
        trailer_url: movie.trailer_url,
        type: movie.type,
        thumb_url: movie.thumb_url,
        poster_url: movie.poster_url,
        episodes: movie.episodes || [],
        cdn: data.data?.APP_DOMAIN_CDN_IMAGE || "https://img.ophim.live"
      };
    }
  },
  Phimapi: {
    url: `https://phimapi.com/phim/${slug}`,
    parser: (data) => {
      const movie = data.movie || data;
      return {
        name: movie.name || movie.title,
        original_name: movie.original_name,
        year: movie.year,
        quality: movie.quality,
        lang: movie.lang,
        episode_current: movie.episode_current,
        rating: movie.tmdb?.vote_average || movie.rating,
        category: movie.category,
        country: movie.country,
        actor: movie.actor,
        content: movie.content,
        trailer_url: movie.trailer_url,
        type: movie.type,
        thumb_url: movie.thumb_url,
        poster_url: movie.poster_url,
        episodes: data.episodes || movie.episodes || []
      };
    }
  },
  Nguonc: {
    url: `https://phim.nguonc.com/api/film/${slug}`,
    parser: (data) => {
      const movie = data.movie || data;
      return {
        name: movie.name || movie.title,
        original_name: movie.original_name,
        year: movie.year,
        quality: movie.quality,
        lang: movie.lang,
        episode_current: movie.current_episode,
        rating: movie.rating,
        category: movie.category,
        country: movie.country,
        actor: movie.actor,
        content: movie.content,
        trailer_url: movie.trailer_url,
        type: movie.type,
        thumb_url: movie.thumb_url,
        poster_url: movie.poster,
        episodes: movie.episodes || []
      };
    }
  },
  TMDB: {
    url: `https://api.themoviedb.org/3/${mediaType}/${tmdbId}?api_key=${TMDB_API_KEY}&language=vi-VN&append_to_response=videos,credits`,
    parser: (data) => {
      return {
        name: data.title || data.name,
        original_name: data.original_title || data.original_name,
        year: (data.release_date || data.first_air_date || '').split('-')[0],
        quality: 'HD',
        lang: data.original_language?.toUpperCase(),
        episode_current: data.number_of_episodes,
        rating: data.vote_average,
        category: data.genres,
        country: data.production_countries,
        actor: data.credits?.cast?.slice(0, 10).map(actor => actor.name),
        content: data.overview,
        trailer_url: data.videos?.results?.find(v => v.type === 'Trailer') ? 
          `https://www.youtube.com/embed/${data.videos.results.find(v => v.type === 'Trailer').key}` : '',
        type: mediaType === 'tv' ? 'series' : 'single',
        thumb_url: data.poster_path ? `https://image.tmdb.org/t/p/w500${data.poster_path}` : '',
        poster_url: data.poster_path ? `https://image.tmdb.org/t/p/w500${data.poster_path}` : '',
        episodes: data.seasons || []
      };
    }
  }
};

// ==================== H√ÄM L·∫§Y POSTER THEO NGU·ªíN ====================
function getPoster(movie) {
  if (source === "TMDB") {
    return movie.poster_url || movie.thumb_url || '';
  }
  
  let url = '';
  if (source === "Phimapi") {
    // bx - ∆ØU TI√äN POSTER
    url = movie.poster_url || movie.thumb_url;
  } else if (source === "Ophim") {
    // ax - ∆ØU TI√äN THUMB
    url = movie.thumb_url || movie.poster_url;
    if (url && !url.startsWith('http') && movie.cdn) {
      const name = url.split('/').pop().replace(/(-poster|-thumb)\.jpg/, '');
      url = `${movie.cdn}/uploads/movies/${name}-thumb.jpg`;
    }
  } else if (source === "Nguonc") {
    // cx - ∆ØU TI√äN THUMB
    url = movie.thumb_url || movie.poster_url;
  }

  // X·ª≠ l√Ω URL t∆∞∆°ng ƒë·ªëi
  if (url && !url.startsWith('http') && movie.cdn) {
    url = movie.cdn + '/' + url.replace(/^\/+/, '');
  }
  
  return url || '';
}

// ==================== H√ÄM X·ª¨ L√ù D·ªÆ LI·ªÜU M·∫¢NG ====================
function processArrayData(data) {
  if (!data) return [];
  
  if (Array.isArray(data)) {
    return data.map(item => item.name || item);
  } else if (typeof data === 'string') {
    return data.split(',').map(item => item.trim());
  }
  
  return [];
}

// ==================== H√ÄM HI·ªÇN TH·ªä T·∫¨P PHIM ====================
function renderEpisodes(episodes) {
  const episodesSection = document.getElementById('episodes-section');
  const watchBtn = document.getElementById('watch-btn');
  
  if (!episodes || episodes.length === 0) {
    document.getElementById('episode-grid').innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#aaa;">Phim l·∫ª - Xem ngay</p>';
    
    // T·∫°o URL xem phim
    if (source === "TMDB") {
      watchBtn.href = `oplay.html?tmdb=${tmdbId}&type=${mediaType}&e=1`;
    } else {
      const sourceMap = {"ax":"Ophim","bx":"Phimapi","cx":"Nguonc"};
      const encodedSource = Object.keys(sourceMap).find(key => sourceMap[key] === source);
      watchBtn.href = `oplay.html?slug=${slug}&source=${encodedSource}&e=1`;
    }
    
    episodesSection.style.display = 'block';
    return;
  }

  const tabs = document.getElementById('server-tabs');
  const grid = document.getElementById('episode-grid');
  tabs.innerHTML = ''; 
  grid.innerHTML = '';
  episodesSection.style.display = 'block';

  episodes.forEach((server, i) => {
    const tab = document.createElement('div');
    tab.className = 'server-tab';
    if (i === 0) tab.classList.add('active');
    tab.textContent = server.server_name || `Server ${i+1}`;
    tab.onclick = () => {
      document.querySelectorAll('.server-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      renderEpisodeList(server.server_data || server.items || []);
    };
    tabs.appendChild(tab);
  });

  renderEpisodeList(episodes[0].server_data || episodes[0].items || []);
}

function renderEpisodeList(items) {
  const grid = document.getElementById('episode-grid');
  const watchBtn = document.getElementById('watch-btn');
  grid.innerHTML = '';
  
  if (!items || items.length === 0) { 
    grid.innerHTML = '<p style="grid-column:1/-1;color:#aaa;">Kh√¥ng c√≥ t·∫≠p</p>'; 
    return; 
  }

  const sourceMap = {"ax":"Ophim","bx":"Phimapi","cx":"Nguonc"};
  const encodedSource = Object.keys(sourceMap).find(key => sourceMap[key] === source);

  items.forEach((ep, i) => {
    const btn = document.createElement('div');
    btn.className = 'episode-btn';
    btn.textContent = ep.name || `T·∫≠p ${i + 1}`;
    const episodeNumber = (i + 1).toString();
    
    btn.onclick = () => {
      grid.querySelectorAll('.episode-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // T·∫°o URL xem phim theo ngu·ªìn
      if (source === "TMDB") {
        watchBtn.href = `oplay.html?tmdb=${tmdbId}&type=${mediaType}&e=${episodeNumber}`;
      } else {
        watchBtn.href = `oplay.html?slug=${slug}&source=${encodedSource}&e=${episodeNumber}`;
      }
    };
    
    grid.appendChild(btn);
  });

  if (grid.children[0]) grid.children[0].click();
}

// ==================== HI·ªÜU ·ª®NG TILT 3D ====================
let isHovering = false;
document.addEventListener('mousemove', (e) => {
  if (!isHovering) return;
  const card = document.getElementById('tiltCard');
  if (!card) return;
  const rect = card.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  const centerX = rect.width / 2;
  const centerY = rect.height / 2;
  const rotateX = (y - centerY) / centerY * -15;
  const rotateY = (x - centerX) / centerX * 15;
  card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
});

// ==================== H√ÄM CH√çNH T·∫¢I D·ªÆ LI·ªÜU ====================
async function loadDetail() {
  const skeleton = document.getElementById("skeleton");
  const content = document.getElementById("detail-content");
  const bg = document.getElementById("bg-poster");

  try {
    const config = API_CONFIG[source];
    if (!config) {
      throw new Error(`Ngu·ªìn ${source} kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£`);
    }

    const res = await fetch(config.url);
    if (!res.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu phim");
    const data = await res.json();

    const movie = config.parser(data);
    if (!movie || !movie.name) {
      throw new Error("Kh√¥ng th·ªÉ ph√¢n t√≠ch d·ªØ li·ªáu phim");
    }

    const poster = getPoster(movie);
    
    // C·∫¨P NH·∫¨T UI
    document.getElementById('poster').src = poster;
    bg.style.backgroundImage = `url(${poster})`;
    document.getElementById('title').textContent = movie.name || "Kh√¥ng r√µ";
    document.getElementById('original-title').textContent = movie.original_name || "";

    // TH√îNG TIN CHI TI·∫æT
    document.getElementById('year').textContent = movie.year || '-';
    document.getElementById('quality').textContent = movie.quality || '-';
    document.getElementById('lang').textContent = movie.lang || '-';
    
    // T·∫¨P HI·ªÜN T·∫†I
    const isTv = movie.type === 'series' || mediaType === 'tv';
    document.getElementById('episode').textContent = isTv ? (movie.episode_current || '-') : 'Phim l·∫ª';
    
    // ƒê√ÅNH GI√Å
    const rating = movie.rating;
    document.getElementById('rating').innerHTML = rating ? `${typeof rating === 'number' ? rating.toFixed(1) : rating}/10` : '-';

    // TH·ªÇ LO·∫†I, QU·ªêC GIA, DI·ªÑN VI√äN
    document.getElementById('genres').innerHTML = processArrayData(movie.category).join(', ') || '-';
    document.getElementById('countries').innerHTML = processArrayData(movie.country).join(', ') || '-';
    document.getElementById('actors').innerHTML = processArrayData(movie.actor).slice(0, 5).join(', ') || '-';

    // M√î T·∫¢
    const fullDesc = (movie.content || movie.description || "Kh√¥ng c√≥ m√¥ t·∫£").replace(/<[^>]+>/g, '').trim();
    const descEl = document.getElementById('desc');
    descEl.textContent = fullDesc;

    const toggleBtn = document.getElementById('toggle-desc');
    if (fullDesc.length > 200) {
      toggleBtn.style.display = 'inline-block';
      toggleBtn.onclick = () => {
        descEl.classList.toggle('expanded');
        toggleBtn.textContent = descEl.classList.contains('expanded') ? 'Thu g·ªçn' : 'Xem th√™m';
      };
    } else {
      toggleBtn.style.display = 'none';
    }

    // TRAILER
    const trailerBtn = document.getElementById('trailer-btn');
    const trailerSection = document.getElementById('trailer-section');
    if (movie.trailer_url) {
      const trailerId = movie.trailer_url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
      if (trailerId) {
        trailerBtn.style.display = 'inline-flex';
        trailerBtn.onclick = () => {
          if (trailerSection.style.display === 'block') {
            trailerSection.style.display = 'none';
            trailerBtn.textContent = 'Xem Trailer';
          } else {
            trailerSection.innerHTML = `<iframe class="trailer-iframe" src="https://www.youtube.com/embed/${trailerId[1]}" frameborder="0" allowfullscreen></iframe>`;
            trailerSection.style.display = 'block';
            trailerBtn.textContent = '·∫®n Trailer';
          }
        };
      }
    } else {
      trailerBtn.style.display = 'none';
    }

    // EPISODES
    renderEpisodes(movie.episodes);

    // SEO
    document.getElementById('page-title').textContent = `${movie.name} - Phim Nh√† B√°nh M√¨`;
    document.getElementById('og-title').content = movie.name;
    document.getElementById('og-desc').content = fullDesc.substring(0, 160) + '...';
    document.getElementById('og-image').content = poster;
    document.getElementById('og-url').content = location.href;

    // K√çCH HO·∫†T TILT EFFECT
    const tiltCard = document.getElementById('tiltCard');
    if (tiltCard) {
      tiltCard.addEventListener('mouseenter', () => { isHovering = true; });
      tiltCard.addEventListener('mouseleave', () => {
        isHovering = false;
        tiltCard.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
      });
    }

    skeleton.style.display = 'none';
    content.style.display = 'block';

  } catch (err) {
    console.error('Load detail error:', err);
    showError(`L·ªói: ${err.message}`);
  }
}

// ==================== H√ÄM HI·ªÇN TH·ªä L·ªñI ====================
function showError(msg) {
  const skeleton = document.getElementById("skeleton");
  const content = document.getElementById("detail-content");
  
  skeleton.style.display = 'none';
  content.style.display = 'block';
  content.innerHTML = `
    <div class="info-card">
      <div style="color:#f66;text-align:center;padding:2rem;">
        <h3>üòî Kh√¥ng th·ªÉ t·∫£i th√¥ng tin phim</h3>
        <p>${msg}</p>
        <button class="back-home" onclick="location.href='index.html'" style="margin-top:1rem;">Quay v·ªÅ trang ch·ªß</button>
      </div>
    </div>
  `;
}

// ==================== KH·ªûI CH·∫†Y ====================
document.addEventListener("DOMContentLoaded", loadDetail);
  </script>
</body>
</html>